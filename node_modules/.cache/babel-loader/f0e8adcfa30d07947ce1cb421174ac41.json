{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { isDocumentVisible } from './utils';\nimport { getCache, setCache } from './utils/cache';\nimport limit from './utils/limit';\nimport usePersistFn from './utils/usePersistFn';\nimport useUpdateEffect from './utils/useUpdateEffect';\nimport subscribeFocus from './utils/windowFocus';\nimport subscribeVisible from './utils/windowVisible';\nvar DEFAULT_KEY = 'AHOOKS_USE_REQUEST_DEFAULT_KEY';\n\nvar Fetch =\n/** @class */\nfunction () {\n  function Fetch(service, config, subscribe, initState) {\n    // 请求时序\n    this.count = 0; // visible 后，是否继续轮询\n\n    this.pollingWhenVisibleFlag = false;\n    this.pollingTimer = undefined;\n    this.loadingDelayTimer = undefined;\n    this.unsubscribe = [];\n    this.that = this;\n    this.state = {\n      loading: false,\n      params: [],\n      data: undefined,\n      error: undefined,\n      run: this.run.bind(this.that),\n      mutate: this.mutate.bind(this.that),\n      refresh: this.refresh.bind(this.that),\n      cancel: this.cancel.bind(this.that),\n      unmount: this.unmount.bind(this.that)\n    };\n    this.service = service;\n    this.config = config;\n    this.subscribe = subscribe;\n\n    if (initState) {\n      this.state = __assign(__assign({}, this.state), initState);\n    }\n\n    this.debounceRun = this.config.debounceInterval ? debounce(this._run, this.config.debounceInterval) : undefined;\n    this.throttleRun = this.config.throttleInterval ? throttle(this._run, this.config.throttleInterval) : undefined;\n    this.limitRefresh = limit(this.refresh.bind(this), this.config.focusTimespan);\n\n    if (this.config.pollingInterval) {\n      this.unsubscribe.push(subscribeVisible(this.rePolling.bind(this)));\n    }\n\n    if (this.config.refreshOnWindowFocus) {\n      this.unsubscribe.push(subscribeFocus(this.limitRefresh.bind(this)));\n    }\n  }\n\n  Fetch.prototype.setState = function (s) {\n    if (s === void 0) {\n      s = {};\n    }\n\n    this.state = __assign(__assign({}, this.state), s);\n    this.subscribe(this.state);\n  };\n\n  Fetch.prototype._run = function () {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    } // 取消已有定时器\n\n\n    if (this.pollingTimer) {\n      clearTimeout(this.pollingTimer);\n    } // 取消 loadingDelayTimer\n\n\n    if (this.loadingDelayTimer) {\n      clearTimeout(this.loadingDelayTimer);\n    }\n\n    this.count += 1; // 闭包存储当次请求的 count\n\n    var currentCount = this.count;\n    this.setState({\n      loading: !this.config.loadingDelay,\n      params: args\n    });\n\n    if (this.config.loadingDelay) {\n      this.loadingDelayTimer = setTimeout(function () {\n        _this.setState({\n          loading: true\n        });\n      }, this.config.loadingDelay);\n    }\n\n    return this.service.apply(this, __spread(args)).then(function (res) {\n      if (currentCount !== _this.count) {\n        // prevent run.then when request is canceled\n        return new Promise(function () {});\n      }\n\n      if (_this.loadingDelayTimer) {\n        clearTimeout(_this.loadingDelayTimer);\n      }\n\n      var formattedResult = _this.config.formatResult ? _this.config.formatResult(res) : res;\n\n      _this.setState({\n        data: formattedResult,\n        error: undefined,\n        loading: false\n      });\n\n      if (_this.config.onSuccess) {\n        _this.config.onSuccess(formattedResult, args);\n      }\n\n      return formattedResult;\n    })[\"catch\"](function (error) {\n      if (currentCount !== _this.count) {\n        // prevent run.then when request is canceled\n        return new Promise(function () {});\n      }\n\n      if (_this.loadingDelayTimer) {\n        clearTimeout(_this.loadingDelayTimer);\n      }\n\n      _this.setState({\n        data: undefined,\n        error: error,\n        loading: false\n      });\n\n      if (_this.config.onError) {\n        _this.config.onError(error, args);\n      } // If throwOnError, user should catch the error self,\n      // or the page will crash\n\n\n      if (_this.config.throwOnError) {\n        throw error;\n      }\n\n      console.error(error); // eslint-disable-next-line prefer-promise-reject-errors\n\n      return Promise.reject('useRequest has caught the exception, if you need to handle the exception yourself, you can set options.throwOnError to true.');\n    })[\"finally\"](function () {\n      if (currentCount === _this.count) {\n        if (_this.config.pollingInterval) {\n          // 如果屏幕隐藏，并且 !pollingWhenHidden, 则停止轮询，并记录 flag，等 visible 时，继续轮询\n          if (!isDocumentVisible() && !_this.config.pollingWhenHidden) {\n            _this.pollingWhenVisibleFlag = true;\n            return;\n          }\n\n          _this.pollingTimer = setTimeout(function () {\n            _this._run.apply(_this, __spread(args));\n          }, _this.config.pollingInterval);\n        }\n      }\n    });\n  };\n\n  Fetch.prototype.run = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (this.debounceRun) {\n      this.debounceRun.apply(this, __spread(args)); // TODO 如果 options 存在 debounceInterval，或 throttleInterval，则 run 和 refresh 不会返回 Promise。 带类型需要修复后，此处变成 return;。\n\n      return Promise.resolve(null);\n    }\n\n    if (this.throttleRun) {\n      this.throttleRun.apply(this, __spread(args));\n      return Promise.resolve(null);\n    }\n\n    return this._run.apply(this, __spread(args));\n  };\n\n  Fetch.prototype.cancel = function () {\n    if (this.debounceRun) {\n      this.debounceRun.cancel();\n    }\n\n    if (this.throttleRun) {\n      this.throttleRun.cancel();\n    }\n\n    if (this.loadingDelayTimer) {\n      clearTimeout(this.loadingDelayTimer);\n    }\n\n    if (this.pollingTimer) {\n      clearTimeout(this.pollingTimer);\n    }\n\n    this.pollingWhenVisibleFlag = false;\n    this.count += 1;\n    this.setState({\n      loading: false\n    });\n  };\n\n  Fetch.prototype.refresh = function () {\n    return this.run.apply(this, __spread(this.state.params));\n  };\n\n  Fetch.prototype.rePolling = function () {\n    if (this.pollingWhenVisibleFlag) {\n      this.pollingWhenVisibleFlag = false;\n      this.refresh();\n    }\n  };\n\n  Fetch.prototype.mutate = function (data) {\n    if (typeof data === 'function') {\n      this.setState({\n        // eslint-disable-next-line react/no-access-state-in-setstate\n        data: data(this.state.data) || {}\n      });\n    } else {\n      this.setState({\n        data: data\n      });\n    }\n  };\n\n  Fetch.prototype.unmount = function () {\n    this.cancel();\n    this.unsubscribe.forEach(function (s) {\n      s();\n    });\n  };\n\n  return Fetch;\n}();\n\nfunction useAsync(service, options) {\n  var _options = options || {};\n\n  var _a = _options.refreshDeps,\n      refreshDeps = _a === void 0 ? [] : _a,\n      _b = _options.manual,\n      manual = _b === void 0 ? false : _b,\n      _c = _options.onSuccess,\n      onSuccess = _c === void 0 ? function () {} : _c,\n      _d = _options.onError,\n      onError = _d === void 0 ? function () {} : _d,\n      _e = _options.defaultLoading,\n      defaultLoading = _e === void 0 ? false : _e,\n      loadingDelay = _options.loadingDelay,\n      _f = _options.pollingInterval,\n      pollingInterval = _f === void 0 ? 0 : _f,\n      _g = _options.pollingWhenHidden,\n      pollingWhenHidden = _g === void 0 ? true : _g,\n      _h = _options.defaultParams,\n      defaultParams = _h === void 0 ? [] : _h,\n      _j = _options.refreshOnWindowFocus,\n      refreshOnWindowFocus = _j === void 0 ? false : _j,\n      _k = _options.focusTimespan,\n      focusTimespan = _k === void 0 ? 5000 : _k,\n      fetchKey = _options.fetchKey,\n      cacheKey = _options.cacheKey,\n      _l = _options.cacheTime,\n      cacheTime = _l === void 0 ? 5 * 60 * 1000 : _l,\n      _m = _options.staleTime,\n      staleTime = _m === void 0 ? 0 : _m,\n      debounceInterval = _options.debounceInterval,\n      throttleInterval = _options.throttleInterval,\n      initialData = _options.initialData,\n      _o = _options.ready,\n      ready = _o === void 0 ? true : _o,\n      _p = _options.throwOnError,\n      throwOnError = _p === void 0 ? false : _p;\n  var newstFetchKey = useRef(DEFAULT_KEY); // 持久化一些函数\n\n  var servicePersist = usePersistFn(service);\n  var onSuccessPersist = usePersistFn(onSuccess);\n  var onErrorPersist = usePersistFn(onError);\n  var fetchKeyPersist = usePersistFn(fetchKey);\n  var formatResult;\n\n  if ('formatResult' in _options) {\n    // eslint-disable-next-line prefer-destructuring\n    formatResult = _options.formatResult;\n  }\n\n  var formatResultPersist = usePersistFn(formatResult);\n  var config = {\n    formatResult: formatResultPersist,\n    onSuccess: onSuccessPersist,\n    onError: onErrorPersist,\n    loadingDelay: loadingDelay,\n    pollingInterval: pollingInterval,\n    pollingWhenHidden: pollingWhenHidden,\n    // refreshOnWindowFocus should not work on manual mode\n    refreshOnWindowFocus: !manual && refreshOnWindowFocus,\n    focusTimespan: focusTimespan,\n    debounceInterval: debounceInterval,\n    throttleInterval: throttleInterval,\n    throwOnError: throwOnError\n  };\n  var subscribe = usePersistFn(function (key, data) {\n    setFetches(function (s) {\n      // eslint-disable-next-line no-param-reassign\n      s[key] = data;\n      return __assign({}, s);\n    });\n  });\n\n  var _q = __read(useState(function () {\n    var _a; // 如果有 缓存，则从缓存中读数据\n\n\n    if (cacheKey) {\n      var cacheData_1 = (_a = getCache(cacheKey)) === null || _a === void 0 ? void 0 : _a.data;\n\n      if (cacheData_1) {\n        newstFetchKey.current = cacheData_1.newstFetchKey;\n        /* 使用 initState, 重新 new Fetch */\n\n        var newFetches_1 = {};\n        Object.keys(cacheData_1.fetches).forEach(function (key) {\n          var cacheFetch = cacheData_1.fetches[key];\n          var newFetch = new Fetch(servicePersist, config, subscribe.bind(null, key), {\n            loading: cacheFetch.loading,\n            params: cacheFetch.params,\n            data: cacheFetch.data,\n            error: cacheFetch.error\n          });\n          newFetches_1[key] = newFetch.state;\n        });\n        return newFetches_1;\n      }\n    }\n\n    return {};\n  }), 2),\n      fetches = _q[0],\n      setFetches = _q[1];\n\n  var fetchesRef = useRef(fetches);\n  fetchesRef.current = fetches;\n  var readyMemoryParams = useRef();\n  var run = useCallback(function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (!ready) {\n      // 没有 ready, 记录请求参数，等 ready 后，发起请求用\n      readyMemoryParams.current = args;\n      return;\n    }\n\n    if (fetchKeyPersist) {\n      var key = fetchKeyPersist.apply(void 0, __spread(args));\n      newstFetchKey.current = key === undefined ? DEFAULT_KEY : key;\n    }\n\n    var currentFetchKey = newstFetchKey.current; // 这里必须用 fetchsRef，而不能用 fetches。\n    // 否则在 reset 完，立即 run 的时候，这里拿到的 fetches 是旧的。\n\n    var currentFetch = fetchesRef.current[currentFetchKey];\n\n    if (!currentFetch) {\n      var newFetch = new Fetch(servicePersist, config, subscribe.bind(null, currentFetchKey), {\n        data: initialData\n      });\n      currentFetch = newFetch.state;\n      setFetches(function (s) {\n        // eslint-disable-next-line no-param-reassign\n        s[currentFetchKey] = currentFetch;\n        return __assign({}, s);\n      });\n    }\n\n    return currentFetch.run.apply(currentFetch, __spread(args));\n  }, [fetchKey, subscribe, ready]);\n  var runRef = useRef(run);\n  runRef.current = run; // cache\n\n  useUpdateEffect(function () {\n    if (cacheKey) {\n      setCache(cacheKey, cacheTime, {\n        fetches: fetches,\n        newstFetchKey: newstFetchKey.current\n      });\n    }\n  }, [cacheKey, fetches]); // for ready\n\n  var hasTriggeredByReady = useRef(false);\n  useUpdateEffect(function () {\n    if (ready) {\n      if (!hasTriggeredByReady.current && readyMemoryParams.current) {\n        runRef.current.apply(runRef, __spread(readyMemoryParams.current));\n      }\n\n      hasTriggeredByReady.current = true;\n    }\n  }, [ready]); // 第一次默认执行\n\n  useEffect(function () {\n    var _a;\n\n    if (!manual) {\n      // 如果有缓存，则重新请求\n      if (Object.keys(fetches).length > 0) {\n        // 如果 staleTime 是 -1，则 cache 永不过期\n        // 如果 statleTime 超期了，则重新请求\n        var cacheStartTime = cacheKey && ((_a = getCache(cacheKey)) === null || _a === void 0 ? void 0 : _a.startTime) || 0;\n\n        if (!(staleTime === -1 || new Date().getTime() - cacheStartTime <= staleTime)) {\n          /* 重新执行所有的 cache */\n          Object.values(fetches).forEach(function (f) {\n            f.refresh();\n          });\n        }\n      } else {\n        // 第一次默认执行，可以通过 defaultParams 设置参数\n        runRef.current.apply(runRef, __spread(defaultParams));\n      }\n    }\n  }, []); // 重置 fetches\n\n  var reset = useCallback(function () {\n    Object.values(fetchesRef.current).forEach(function (f) {\n      f.unmount();\n    });\n    newstFetchKey.current = DEFAULT_KEY;\n    setFetches({}); // 不写会有问题。如果不写，此时立即 run，会是老的数据\n\n    fetchesRef.current = {};\n  }, [setFetches]); //  refreshDeps 变化，重新执行所有请求\n\n  useUpdateEffect(function () {\n    if (!manual) {\n      /* 全部重新执行 */\n      Object.values(fetchesRef.current).forEach(function (f) {\n        f.refresh();\n      });\n    }\n  }, __spread(refreshDeps)); // 卸载组件触发\n\n  useEffect(function () {\n    return function () {\n      Object.values(fetchesRef.current).forEach(function (f) {\n        f.unmount();\n      });\n    };\n  }, []);\n  var notExecutedWarning = useCallback(function (name) {\n    return function () {\n      console.warn(\"You should't call \" + name + \" when service not executed once.\");\n    };\n  }, []);\n  return __assign(__assign({\n    loading: ready && !manual || defaultLoading,\n    data: initialData,\n    error: undefined,\n    params: [],\n    cancel: notExecutedWarning('cancel'),\n    refresh: notExecutedWarning('refresh'),\n    mutate: notExecutedWarning('mutate')\n  }, fetches[newstFetchKey.current] || {}), {\n    run: run,\n    fetches: fetches,\n    reset: reset\n  });\n}\n\nexport default useAsync;","map":{"version":3,"sources":["/Users/brandonliu/Project/goairmart/antd-demo/node_modules/@ahooksjs/use-request/es/useAsync.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__read","o","m","Symbol","iterator","r","ar","e","next","done","push","value","error","__spread","concat","debounce","throttle","useCallback","useEffect","useRef","useState","isDocumentVisible","getCache","setCache","limit","usePersistFn","useUpdateEffect","subscribeFocus","subscribeVisible","DEFAULT_KEY","Fetch","service","config","subscribe","initState","count","pollingWhenVisibleFlag","pollingTimer","undefined","loadingDelayTimer","unsubscribe","that","state","loading","params","data","run","bind","mutate","refresh","cancel","unmount","debounceRun","debounceInterval","_run","throttleRun","throttleInterval","limitRefresh","focusTimespan","pollingInterval","rePolling","refreshOnWindowFocus","setState","_this","args","_i","clearTimeout","currentCount","loadingDelay","setTimeout","then","res","Promise","formattedResult","formatResult","onSuccess","onError","throwOnError","console","reject","pollingWhenHidden","resolve","forEach","useAsync","options","_options","_a","refreshDeps","_b","manual","_c","_d","_e","defaultLoading","_f","_g","_h","defaultParams","_j","_k","fetchKey","cacheKey","_l","cacheTime","_m","staleTime","initialData","_o","ready","_p","newstFetchKey","servicePersist","onSuccessPersist","onErrorPersist","fetchKeyPersist","formatResultPersist","key","setFetches","_q","cacheData_1","current","newFetches_1","keys","fetches","cacheFetch","newFetch","fetchesRef","readyMemoryParams","currentFetchKey","currentFetch","runRef","hasTriggeredByReady","cacheStartTime","startTime","Date","getTime","values","f","reset","notExecutedWarning","name","warn"],"mappings":"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","sourcesContent":["var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nimport debounce from 'lodash.debounce';\nimport throttle from 'lodash.throttle';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { isDocumentVisible } from './utils';\nimport { getCache, setCache } from './utils/cache';\nimport limit from './utils/limit';\nimport usePersistFn from './utils/usePersistFn';\nimport useUpdateEffect from './utils/useUpdateEffect';\nimport subscribeFocus from './utils/windowFocus';\nimport subscribeVisible from './utils/windowVisible';\nvar DEFAULT_KEY = 'AHOOKS_USE_REQUEST_DEFAULT_KEY';\n\nvar Fetch =\n/** @class */\nfunction () {\n  function Fetch(service, config, subscribe, initState) {\n    // 请求时序\n    this.count = 0; // visible 后，是否继续轮询\n\n    this.pollingWhenVisibleFlag = false;\n    this.pollingTimer = undefined;\n    this.loadingDelayTimer = undefined;\n    this.unsubscribe = [];\n    this.that = this;\n    this.state = {\n      loading: false,\n      params: [],\n      data: undefined,\n      error: undefined,\n      run: this.run.bind(this.that),\n      mutate: this.mutate.bind(this.that),\n      refresh: this.refresh.bind(this.that),\n      cancel: this.cancel.bind(this.that),\n      unmount: this.unmount.bind(this.that)\n    };\n    this.service = service;\n    this.config = config;\n    this.subscribe = subscribe;\n\n    if (initState) {\n      this.state = __assign(__assign({}, this.state), initState);\n    }\n\n    this.debounceRun = this.config.debounceInterval ? debounce(this._run, this.config.debounceInterval) : undefined;\n    this.throttleRun = this.config.throttleInterval ? throttle(this._run, this.config.throttleInterval) : undefined;\n    this.limitRefresh = limit(this.refresh.bind(this), this.config.focusTimespan);\n\n    if (this.config.pollingInterval) {\n      this.unsubscribe.push(subscribeVisible(this.rePolling.bind(this)));\n    }\n\n    if (this.config.refreshOnWindowFocus) {\n      this.unsubscribe.push(subscribeFocus(this.limitRefresh.bind(this)));\n    }\n  }\n\n  Fetch.prototype.setState = function (s) {\n    if (s === void 0) {\n      s = {};\n    }\n\n    this.state = __assign(__assign({}, this.state), s);\n    this.subscribe(this.state);\n  };\n\n  Fetch.prototype._run = function () {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    } // 取消已有定时器\n\n\n    if (this.pollingTimer) {\n      clearTimeout(this.pollingTimer);\n    } // 取消 loadingDelayTimer\n\n\n    if (this.loadingDelayTimer) {\n      clearTimeout(this.loadingDelayTimer);\n    }\n\n    this.count += 1; // 闭包存储当次请求的 count\n\n    var currentCount = this.count;\n    this.setState({\n      loading: !this.config.loadingDelay,\n      params: args\n    });\n\n    if (this.config.loadingDelay) {\n      this.loadingDelayTimer = setTimeout(function () {\n        _this.setState({\n          loading: true\n        });\n      }, this.config.loadingDelay);\n    }\n\n    return this.service.apply(this, __spread(args)).then(function (res) {\n      if (currentCount !== _this.count) {\n        // prevent run.then when request is canceled\n        return new Promise(function () {});\n      }\n\n      if (_this.loadingDelayTimer) {\n        clearTimeout(_this.loadingDelayTimer);\n      }\n\n      var formattedResult = _this.config.formatResult ? _this.config.formatResult(res) : res;\n\n      _this.setState({\n        data: formattedResult,\n        error: undefined,\n        loading: false\n      });\n\n      if (_this.config.onSuccess) {\n        _this.config.onSuccess(formattedResult, args);\n      }\n\n      return formattedResult;\n    })[\"catch\"](function (error) {\n      if (currentCount !== _this.count) {\n        // prevent run.then when request is canceled\n        return new Promise(function () {});\n      }\n\n      if (_this.loadingDelayTimer) {\n        clearTimeout(_this.loadingDelayTimer);\n      }\n\n      _this.setState({\n        data: undefined,\n        error: error,\n        loading: false\n      });\n\n      if (_this.config.onError) {\n        _this.config.onError(error, args);\n      } // If throwOnError, user should catch the error self,\n      // or the page will crash\n\n\n      if (_this.config.throwOnError) {\n        throw error;\n      }\n\n      console.error(error); // eslint-disable-next-line prefer-promise-reject-errors\n\n      return Promise.reject('useRequest has caught the exception, if you need to handle the exception yourself, you can set options.throwOnError to true.');\n    })[\"finally\"](function () {\n      if (currentCount === _this.count) {\n        if (_this.config.pollingInterval) {\n          // 如果屏幕隐藏，并且 !pollingWhenHidden, 则停止轮询，并记录 flag，等 visible 时，继续轮询\n          if (!isDocumentVisible() && !_this.config.pollingWhenHidden) {\n            _this.pollingWhenVisibleFlag = true;\n            return;\n          }\n\n          _this.pollingTimer = setTimeout(function () {\n            _this._run.apply(_this, __spread(args));\n          }, _this.config.pollingInterval);\n        }\n      }\n    });\n  };\n\n  Fetch.prototype.run = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (this.debounceRun) {\n      this.debounceRun.apply(this, __spread(args)); // TODO 如果 options 存在 debounceInterval，或 throttleInterval，则 run 和 refresh 不会返回 Promise。 带类型需要修复后，此处变成 return;。\n\n      return Promise.resolve(null);\n    }\n\n    if (this.throttleRun) {\n      this.throttleRun.apply(this, __spread(args));\n      return Promise.resolve(null);\n    }\n\n    return this._run.apply(this, __spread(args));\n  };\n\n  Fetch.prototype.cancel = function () {\n    if (this.debounceRun) {\n      this.debounceRun.cancel();\n    }\n\n    if (this.throttleRun) {\n      this.throttleRun.cancel();\n    }\n\n    if (this.loadingDelayTimer) {\n      clearTimeout(this.loadingDelayTimer);\n    }\n\n    if (this.pollingTimer) {\n      clearTimeout(this.pollingTimer);\n    }\n\n    this.pollingWhenVisibleFlag = false;\n    this.count += 1;\n    this.setState({\n      loading: false\n    });\n  };\n\n  Fetch.prototype.refresh = function () {\n    return this.run.apply(this, __spread(this.state.params));\n  };\n\n  Fetch.prototype.rePolling = function () {\n    if (this.pollingWhenVisibleFlag) {\n      this.pollingWhenVisibleFlag = false;\n      this.refresh();\n    }\n  };\n\n  Fetch.prototype.mutate = function (data) {\n    if (typeof data === 'function') {\n      this.setState({\n        // eslint-disable-next-line react/no-access-state-in-setstate\n        data: data(this.state.data) || {}\n      });\n    } else {\n      this.setState({\n        data: data\n      });\n    }\n  };\n\n  Fetch.prototype.unmount = function () {\n    this.cancel();\n    this.unsubscribe.forEach(function (s) {\n      s();\n    });\n  };\n\n  return Fetch;\n}();\n\nfunction useAsync(service, options) {\n  var _options = options || {};\n\n  var _a = _options.refreshDeps,\n      refreshDeps = _a === void 0 ? [] : _a,\n      _b = _options.manual,\n      manual = _b === void 0 ? false : _b,\n      _c = _options.onSuccess,\n      onSuccess = _c === void 0 ? function () {} : _c,\n      _d = _options.onError,\n      onError = _d === void 0 ? function () {} : _d,\n      _e = _options.defaultLoading,\n      defaultLoading = _e === void 0 ? false : _e,\n      loadingDelay = _options.loadingDelay,\n      _f = _options.pollingInterval,\n      pollingInterval = _f === void 0 ? 0 : _f,\n      _g = _options.pollingWhenHidden,\n      pollingWhenHidden = _g === void 0 ? true : _g,\n      _h = _options.defaultParams,\n      defaultParams = _h === void 0 ? [] : _h,\n      _j = _options.refreshOnWindowFocus,\n      refreshOnWindowFocus = _j === void 0 ? false : _j,\n      _k = _options.focusTimespan,\n      focusTimespan = _k === void 0 ? 5000 : _k,\n      fetchKey = _options.fetchKey,\n      cacheKey = _options.cacheKey,\n      _l = _options.cacheTime,\n      cacheTime = _l === void 0 ? 5 * 60 * 1000 : _l,\n      _m = _options.staleTime,\n      staleTime = _m === void 0 ? 0 : _m,\n      debounceInterval = _options.debounceInterval,\n      throttleInterval = _options.throttleInterval,\n      initialData = _options.initialData,\n      _o = _options.ready,\n      ready = _o === void 0 ? true : _o,\n      _p = _options.throwOnError,\n      throwOnError = _p === void 0 ? false : _p;\n  var newstFetchKey = useRef(DEFAULT_KEY); // 持久化一些函数\n\n  var servicePersist = usePersistFn(service);\n  var onSuccessPersist = usePersistFn(onSuccess);\n  var onErrorPersist = usePersistFn(onError);\n  var fetchKeyPersist = usePersistFn(fetchKey);\n  var formatResult;\n\n  if ('formatResult' in _options) {\n    // eslint-disable-next-line prefer-destructuring\n    formatResult = _options.formatResult;\n  }\n\n  var formatResultPersist = usePersistFn(formatResult);\n  var config = {\n    formatResult: formatResultPersist,\n    onSuccess: onSuccessPersist,\n    onError: onErrorPersist,\n    loadingDelay: loadingDelay,\n    pollingInterval: pollingInterval,\n    pollingWhenHidden: pollingWhenHidden,\n    // refreshOnWindowFocus should not work on manual mode\n    refreshOnWindowFocus: !manual && refreshOnWindowFocus,\n    focusTimespan: focusTimespan,\n    debounceInterval: debounceInterval,\n    throttleInterval: throttleInterval,\n    throwOnError: throwOnError\n  };\n  var subscribe = usePersistFn(function (key, data) {\n    setFetches(function (s) {\n      // eslint-disable-next-line no-param-reassign\n      s[key] = data;\n      return __assign({}, s);\n    });\n  });\n\n  var _q = __read(useState(function () {\n    var _a; // 如果有 缓存，则从缓存中读数据\n\n\n    if (cacheKey) {\n      var cacheData_1 = (_a = getCache(cacheKey)) === null || _a === void 0 ? void 0 : _a.data;\n\n      if (cacheData_1) {\n        newstFetchKey.current = cacheData_1.newstFetchKey;\n        /* 使用 initState, 重新 new Fetch */\n\n        var newFetches_1 = {};\n        Object.keys(cacheData_1.fetches).forEach(function (key) {\n          var cacheFetch = cacheData_1.fetches[key];\n          var newFetch = new Fetch(servicePersist, config, subscribe.bind(null, key), {\n            loading: cacheFetch.loading,\n            params: cacheFetch.params,\n            data: cacheFetch.data,\n            error: cacheFetch.error\n          });\n          newFetches_1[key] = newFetch.state;\n        });\n        return newFetches_1;\n      }\n    }\n\n    return {};\n  }), 2),\n      fetches = _q[0],\n      setFetches = _q[1];\n\n  var fetchesRef = useRef(fetches);\n  fetchesRef.current = fetches;\n  var readyMemoryParams = useRef();\n  var run = useCallback(function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (!ready) {\n      // 没有 ready, 记录请求参数，等 ready 后，发起请求用\n      readyMemoryParams.current = args;\n      return;\n    }\n\n    if (fetchKeyPersist) {\n      var key = fetchKeyPersist.apply(void 0, __spread(args));\n      newstFetchKey.current = key === undefined ? DEFAULT_KEY : key;\n    }\n\n    var currentFetchKey = newstFetchKey.current; // 这里必须用 fetchsRef，而不能用 fetches。\n    // 否则在 reset 完，立即 run 的时候，这里拿到的 fetches 是旧的。\n\n    var currentFetch = fetchesRef.current[currentFetchKey];\n\n    if (!currentFetch) {\n      var newFetch = new Fetch(servicePersist, config, subscribe.bind(null, currentFetchKey), {\n        data: initialData\n      });\n      currentFetch = newFetch.state;\n      setFetches(function (s) {\n        // eslint-disable-next-line no-param-reassign\n        s[currentFetchKey] = currentFetch;\n        return __assign({}, s);\n      });\n    }\n\n    return currentFetch.run.apply(currentFetch, __spread(args));\n  }, [fetchKey, subscribe, ready]);\n  var runRef = useRef(run);\n  runRef.current = run; // cache\n\n  useUpdateEffect(function () {\n    if (cacheKey) {\n      setCache(cacheKey, cacheTime, {\n        fetches: fetches,\n        newstFetchKey: newstFetchKey.current\n      });\n    }\n  }, [cacheKey, fetches]); // for ready\n\n  var hasTriggeredByReady = useRef(false);\n  useUpdateEffect(function () {\n    if (ready) {\n      if (!hasTriggeredByReady.current && readyMemoryParams.current) {\n        runRef.current.apply(runRef, __spread(readyMemoryParams.current));\n      }\n\n      hasTriggeredByReady.current = true;\n    }\n  }, [ready]); // 第一次默认执行\n\n  useEffect(function () {\n    var _a;\n\n    if (!manual) {\n      // 如果有缓存，则重新请求\n      if (Object.keys(fetches).length > 0) {\n        // 如果 staleTime 是 -1，则 cache 永不过期\n        // 如果 statleTime 超期了，则重新请求\n        var cacheStartTime = cacheKey && ((_a = getCache(cacheKey)) === null || _a === void 0 ? void 0 : _a.startTime) || 0;\n\n        if (!(staleTime === -1 || new Date().getTime() - cacheStartTime <= staleTime)) {\n          /* 重新执行所有的 cache */\n          Object.values(fetches).forEach(function (f) {\n            f.refresh();\n          });\n        }\n      } else {\n        // 第一次默认执行，可以通过 defaultParams 设置参数\n        runRef.current.apply(runRef, __spread(defaultParams));\n      }\n    }\n  }, []); // 重置 fetches\n\n  var reset = useCallback(function () {\n    Object.values(fetchesRef.current).forEach(function (f) {\n      f.unmount();\n    });\n    newstFetchKey.current = DEFAULT_KEY;\n    setFetches({}); // 不写会有问题。如果不写，此时立即 run，会是老的数据\n\n    fetchesRef.current = {};\n  }, [setFetches]); //  refreshDeps 变化，重新执行所有请求\n\n  useUpdateEffect(function () {\n    if (!manual) {\n      /* 全部重新执行 */\n      Object.values(fetchesRef.current).forEach(function (f) {\n        f.refresh();\n      });\n    }\n  }, __spread(refreshDeps)); // 卸载组件触发\n\n  useEffect(function () {\n    return function () {\n      Object.values(fetchesRef.current).forEach(function (f) {\n        f.unmount();\n      });\n    };\n  }, []);\n  var notExecutedWarning = useCallback(function (name) {\n    return function () {\n      console.warn(\"You should't call \" + name + \" when service not executed once.\");\n    };\n  }, []);\n  return __assign(__assign({\n    loading: ready && !manual || defaultLoading,\n    data: initialData,\n    error: undefined,\n    params: [],\n    cancel: notExecutedWarning('cancel'),\n    refresh: notExecutedWarning('refresh'),\n    mutate: notExecutedWarning('mutate')\n  }, fetches[newstFetchKey.current] || {}), {\n    run: run,\n    fetches: fetches,\n    reset: reset\n  });\n}\n\nexport default useAsync;"]},"metadata":{},"sourceType":"module"}