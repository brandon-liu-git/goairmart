{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport useAsync from './useAsync';\nimport useUpdateEffect from './utils/useUpdateEffect';\n\nfunction usePaginated(service, options) {\n  var paginated = options.paginated,\n      _a = options.defaultPageSize,\n      defaultPageSize = _a === void 0 ? 10 : _a,\n      _b = options.refreshDeps,\n      refreshDeps = _b === void 0 ? [] : _b,\n      fetchKey = options.fetchKey,\n      restOptions = __rest(options, [\"paginated\", \"defaultPageSize\", \"refreshDeps\", \"fetchKey\"]);\n\n  useEffect(function () {\n    if (fetchKey) {\n      console.error(\"useRequest pagination's fetchKey will not work!\");\n    }\n  }, []);\n\n  var _c = useAsync(service, __assign({\n    defaultParams: [{\n      current: 1,\n      pageSize: defaultPageSize\n    }]\n  }, restOptions)),\n      data = _c.data,\n      params = _c.params,\n      run = _c.run,\n      loading = _c.loading,\n      rest = __rest(_c, [\"data\", \"params\", \"run\", \"loading\"]);\n\n  var _d = params && params[0] ? params[0] : {},\n      _e = _d.current,\n      current = _e === void 0 ? 1 : _e,\n      _f = _d.pageSize,\n      pageSize = _f === void 0 ? defaultPageSize : _f,\n      _g = _d.sorter,\n      sorter = _g === void 0 ? {} : _g,\n      _h = _d.filters,\n      filters = _h === void 0 ? {} : _h; // 只改变 pagination，其他参数原样传递\n\n\n  var runChangePagination = useCallback(function (paginationParams) {\n    var _a = __read(params),\n        oldPaginationParams = _a[0],\n        restParams = _a.slice(1);\n\n    run.apply(void 0, __spread([__assign(__assign({}, oldPaginationParams), paginationParams)], restParams));\n  }, [run, params]);\n  var total = (data === null || data === void 0 ? void 0 : data.total) || 0;\n  var totalPage = useMemo(function () {\n    return Math.ceil(total / pageSize);\n  }, [pageSize, total]);\n  var onChange = useCallback(function (c, p) {\n    var toCurrent = c <= 0 ? 1 : c;\n    var toPageSize = p <= 0 ? 1 : p;\n    var tempTotalPage = Math.ceil(total / toPageSize);\n\n    if (toCurrent > tempTotalPage) {\n      toCurrent = tempTotalPage;\n    }\n\n    runChangePagination({\n      current: c,\n      pageSize: p\n    });\n  }, [total, runChangePagination]);\n  var changeCurrent = useCallback(function (c) {\n    onChange(c, pageSize);\n  }, [onChange, pageSize]);\n  var changePageSize = useCallback(function (p) {\n    onChange(current, p);\n  }, [onChange, current]);\n  var changeCurrentRef = useRef(changeCurrent);\n  changeCurrentRef.current = changeCurrent;\n  /* 分页场景下，如果 refreshDeps 变化，重置分页 */\n\n  useUpdateEffect(function () {\n    /* 只有自动执行的场景， refreshDeps 才有效 */\n    if (!options.manual) {\n      changeCurrentRef.current(1);\n    }\n  }, __spread(refreshDeps)); // 表格翻页 排序 筛选等\n\n  var changeTable = useCallback(function (p, f, s) {\n    runChangePagination({\n      current: p.current,\n      pageSize: p.pageSize || defaultPageSize,\n      filters: f,\n      sorter: s\n    });\n  }, [filters, sorter, runChangePagination]);\n  return __assign({\n    loading: loading,\n    data: data,\n    params: params,\n    run: run,\n    pagination: {\n      current: current,\n      pageSize: pageSize,\n      total: total,\n      totalPage: totalPage,\n      onChange: onChange,\n      changeCurrent: changeCurrent,\n      changePageSize: changePageSize\n    },\n    tableProps: {\n      dataSource: (data === null || data === void 0 ? void 0 : data.list) || [],\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: current,\n        pageSize: pageSize,\n        total: total\n      }\n    },\n    sorter: sorter,\n    filters: filters\n  }, rest);\n}\n\nexport default usePaginated;","map":{"version":3,"sources":["/Users/brandonliu/Project/goairmart/antd-demo/node_modules/@ahooksjs/use-request/es/usePaginated.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__read","o","m","Symbol","iterator","r","ar","next","done","push","value","error","__spread","concat","useCallback","useEffect","useMemo","useRef","useAsync","useUpdateEffect","usePaginated","service","options","paginated","_a","defaultPageSize","_b","refreshDeps","fetchKey","restOptions","console","_c","defaultParams","current","pageSize","data","params","run","loading","rest","_d","_e","_f","_g","sorter","_h","filters","runChangePagination","paginationParams","oldPaginationParams","restParams","slice","total","totalPage","Math","ceil","onChange","c","toCurrent","toPageSize","tempTotalPage","changeCurrent","changePageSize","changeCurrentRef","manual","changeTable","f","pagination","tableProps","dataSource","list"],"mappings":"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","sourcesContent":["var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport useAsync from './useAsync';\nimport useUpdateEffect from './utils/useUpdateEffect';\n\nfunction usePaginated(service, options) {\n  var paginated = options.paginated,\n      _a = options.defaultPageSize,\n      defaultPageSize = _a === void 0 ? 10 : _a,\n      _b = options.refreshDeps,\n      refreshDeps = _b === void 0 ? [] : _b,\n      fetchKey = options.fetchKey,\n      restOptions = __rest(options, [\"paginated\", \"defaultPageSize\", \"refreshDeps\", \"fetchKey\"]);\n\n  useEffect(function () {\n    if (fetchKey) {\n      console.error(\"useRequest pagination's fetchKey will not work!\");\n    }\n  }, []);\n\n  var _c = useAsync(service, __assign({\n    defaultParams: [{\n      current: 1,\n      pageSize: defaultPageSize\n    }]\n  }, restOptions)),\n      data = _c.data,\n      params = _c.params,\n      run = _c.run,\n      loading = _c.loading,\n      rest = __rest(_c, [\"data\", \"params\", \"run\", \"loading\"]);\n\n  var _d = params && params[0] ? params[0] : {},\n      _e = _d.current,\n      current = _e === void 0 ? 1 : _e,\n      _f = _d.pageSize,\n      pageSize = _f === void 0 ? defaultPageSize : _f,\n      _g = _d.sorter,\n      sorter = _g === void 0 ? {} : _g,\n      _h = _d.filters,\n      filters = _h === void 0 ? {} : _h; // 只改变 pagination，其他参数原样传递\n\n\n  var runChangePagination = useCallback(function (paginationParams) {\n    var _a = __read(params),\n        oldPaginationParams = _a[0],\n        restParams = _a.slice(1);\n\n    run.apply(void 0, __spread([__assign(__assign({}, oldPaginationParams), paginationParams)], restParams));\n  }, [run, params]);\n  var total = (data === null || data === void 0 ? void 0 : data.total) || 0;\n  var totalPage = useMemo(function () {\n    return Math.ceil(total / pageSize);\n  }, [pageSize, total]);\n  var onChange = useCallback(function (c, p) {\n    var toCurrent = c <= 0 ? 1 : c;\n    var toPageSize = p <= 0 ? 1 : p;\n    var tempTotalPage = Math.ceil(total / toPageSize);\n\n    if (toCurrent > tempTotalPage) {\n      toCurrent = tempTotalPage;\n    }\n\n    runChangePagination({\n      current: c,\n      pageSize: p\n    });\n  }, [total, runChangePagination]);\n  var changeCurrent = useCallback(function (c) {\n    onChange(c, pageSize);\n  }, [onChange, pageSize]);\n  var changePageSize = useCallback(function (p) {\n    onChange(current, p);\n  }, [onChange, current]);\n  var changeCurrentRef = useRef(changeCurrent);\n  changeCurrentRef.current = changeCurrent;\n  /* 分页场景下，如果 refreshDeps 变化，重置分页 */\n\n  useUpdateEffect(function () {\n    /* 只有自动执行的场景， refreshDeps 才有效 */\n    if (!options.manual) {\n      changeCurrentRef.current(1);\n    }\n  }, __spread(refreshDeps)); // 表格翻页 排序 筛选等\n\n  var changeTable = useCallback(function (p, f, s) {\n    runChangePagination({\n      current: p.current,\n      pageSize: p.pageSize || defaultPageSize,\n      filters: f,\n      sorter: s\n    });\n  }, [filters, sorter, runChangePagination]);\n  return __assign({\n    loading: loading,\n    data: data,\n    params: params,\n    run: run,\n    pagination: {\n      current: current,\n      pageSize: pageSize,\n      total: total,\n      totalPage: totalPage,\n      onChange: onChange,\n      changeCurrent: changeCurrent,\n      changePageSize: changePageSize\n    },\n    tableProps: {\n      dataSource: (data === null || data === void 0 ? void 0 : data.list) || [],\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: current,\n        pageSize: pageSize,\n        total: total\n      }\n    },\n    sorter: sorter,\n    filters: filters\n  }, rest);\n}\n\nexport default usePaginated;"]},"metadata":{},"sourceType":"module"}