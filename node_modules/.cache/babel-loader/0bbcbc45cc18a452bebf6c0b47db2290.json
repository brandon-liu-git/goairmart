{"ast":null,"code":"import classNames from 'classnames';\nimport React, { useMemo } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getTreeDeep } from '../../utils/tree';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nvar classPrefix = \"adm-tree-select\";\nvar defaultProps = {\n  options: [],\n  fieldNames: {},\n  defaultValue: []\n};\nexport var TreeSelect = function TreeSelect(p) {\n  var props = mergeProps(defaultProps, p);\n  var labelName = props.fieldNames.label || 'label';\n  var valueName = props.fieldNames.value || 'value';\n  var childrenName = props.fieldNames.children || 'children';\n\n  var _usePropsValue = usePropsValue({\n    value: props.value,\n    defaultValue: props.defaultValue\n  }),\n      value = _usePropsValue[0],\n      setValue = _usePropsValue[1];\n\n  var _useMemo = useMemo(function () {\n    var deep = getTreeDeep(props.options, childrenName);\n    var optionsMap = new Map();\n    var optionsParentMap = new Map();\n\n    function traverse(current, children) {\n      children.forEach(function (item) {\n        optionsParentMap.set(item[valueName], current);\n        optionsMap.set(item[valueName], item);\n\n        if (item[childrenName]) {\n          traverse(item, item[childrenName]);\n        }\n      });\n    }\n\n    traverse(undefined, props.options);\n    return [deep, optionsMap, optionsParentMap];\n  }, [props.options]),\n      deep = _useMemo[0],\n      optionsMap = _useMemo[1],\n      optionsParentMap = _useMemo[2];\n\n  var onItemSelect = function onItemSelect(node) {\n    var _a; // 找到父级节点\n\n\n    var parentNodes = [];\n    var current = node;\n\n    while (current) {\n      parentNodes.unshift(current);\n      var next = optionsParentMap.get(current[valueName]);\n      current = next;\n    }\n\n    var values = parentNodes.map(function (i) {\n      return i[valueName];\n    });\n    setValue(values);\n    (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, values, {\n      options: parentNodes\n    });\n  };\n\n  var renderItems = function renderItems(columnOptions, index) {\n    if (columnOptions === void 0) {\n      columnOptions = [];\n    }\n\n    return columnOptions.map(function (item) {\n      var _classNames;\n\n      var isActive = item[valueName] === value[index];\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: item[valueName],\n        className: classNames(classPrefix + \"-item\", (_classNames = {}, _classNames[classPrefix + \"-item-active\"] = isActive, _classNames)),\n        onClick: function onClick() {\n          if (!isActive) {\n            onItemSelect(item);\n          }\n        }\n      }, item[labelName]);\n    });\n  };\n\n  var renderColumns = function renderColumns() {\n    var _a;\n\n    var columns = [];\n\n    for (var i = 0; i < deep; i++) {\n      var width = 100 / deep + \"%\"; // 两列的第一列宽度为 33.33，两列的第二列为 66.67%\n\n      if (deep === 2 && i === 0) {\n        width = \"33.33%\";\n      }\n\n      if (deep === 2 && i === 1) {\n        width = \"66.67%\";\n      }\n\n      var column = /*#__PURE__*/React.createElement(\"div\", {\n        key: i,\n        className: classNames(classPrefix + \"-column\"),\n        style: {\n          width: width\n        }\n      }, renderItems(i === 0 ? props.options : (_a = optionsMap.get(value[i - 1])) === null || _a === void 0 ? void 0 : _a[childrenName], i));\n      columns.push(column);\n    }\n\n    return columns;\n  };\n\n  return withNativeProps(props, /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix\n  }, renderColumns()));\n};","map":{"version":3,"sources":["/Users/brandonliu/Project/goairmart/antd-demo/node_modules/antd-mobile/es/components/tree-select/tree-select.js"],"names":["classNames","React","useMemo","withNativeProps","getTreeDeep","mergeProps","usePropsValue","classPrefix","defaultProps","options","fieldNames","defaultValue","TreeSelect","p","props","labelName","label","valueName","value","childrenName","children","_usePropsValue","setValue","_useMemo","deep","optionsMap","Map","optionsParentMap","traverse","current","forEach","item","set","undefined","onItemSelect","node","_a","parentNodes","unshift","next","get","values","map","i","onChange","call","renderItems","columnOptions","index","_classNames","isActive","createElement","key","className","onClick","renderColumns","columns","width","column","style","push"],"mappings":"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","sourcesContent":["import classNames from 'classnames';\nimport React, { useMemo } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getTreeDeep } from '../../utils/tree';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nvar classPrefix = \"adm-tree-select\";\nvar defaultProps = {\n  options: [],\n  fieldNames: {},\n  defaultValue: []\n};\nexport var TreeSelect = function TreeSelect(p) {\n  var props = mergeProps(defaultProps, p);\n  var labelName = props.fieldNames.label || 'label';\n  var valueName = props.fieldNames.value || 'value';\n  var childrenName = props.fieldNames.children || 'children';\n\n  var _usePropsValue = usePropsValue({\n    value: props.value,\n    defaultValue: props.defaultValue\n  }),\n      value = _usePropsValue[0],\n      setValue = _usePropsValue[1];\n\n  var _useMemo = useMemo(function () {\n    var deep = getTreeDeep(props.options, childrenName);\n    var optionsMap = new Map();\n    var optionsParentMap = new Map();\n\n    function traverse(current, children) {\n      children.forEach(function (item) {\n        optionsParentMap.set(item[valueName], current);\n        optionsMap.set(item[valueName], item);\n\n        if (item[childrenName]) {\n          traverse(item, item[childrenName]);\n        }\n      });\n    }\n\n    traverse(undefined, props.options);\n    return [deep, optionsMap, optionsParentMap];\n  }, [props.options]),\n      deep = _useMemo[0],\n      optionsMap = _useMemo[1],\n      optionsParentMap = _useMemo[2];\n\n  var onItemSelect = function onItemSelect(node) {\n    var _a; // 找到父级节点\n\n\n    var parentNodes = [];\n    var current = node;\n\n    while (current) {\n      parentNodes.unshift(current);\n      var next = optionsParentMap.get(current[valueName]);\n      current = next;\n    }\n\n    var values = parentNodes.map(function (i) {\n      return i[valueName];\n    });\n    setValue(values);\n    (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, values, {\n      options: parentNodes\n    });\n  };\n\n  var renderItems = function renderItems(columnOptions, index) {\n    if (columnOptions === void 0) {\n      columnOptions = [];\n    }\n\n    return columnOptions.map(function (item) {\n      var _classNames;\n\n      var isActive = item[valueName] === value[index];\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: item[valueName],\n        className: classNames(classPrefix + \"-item\", (_classNames = {}, _classNames[classPrefix + \"-item-active\"] = isActive, _classNames)),\n        onClick: function onClick() {\n          if (!isActive) {\n            onItemSelect(item);\n          }\n        }\n      }, item[labelName]);\n    });\n  };\n\n  var renderColumns = function renderColumns() {\n    var _a;\n\n    var columns = [];\n\n    for (var i = 0; i < deep; i++) {\n      var width = 100 / deep + \"%\"; // 两列的第一列宽度为 33.33，两列的第二列为 66.67%\n\n      if (deep === 2 && i === 0) {\n        width = \"33.33%\";\n      }\n\n      if (deep === 2 && i === 1) {\n        width = \"66.67%\";\n      }\n\n      var column = /*#__PURE__*/React.createElement(\"div\", {\n        key: i,\n        className: classNames(classPrefix + \"-column\"),\n        style: {\n          width: width\n        }\n      }, renderItems(i === 0 ? props.options : (_a = optionsMap.get(value[i - 1])) === null || _a === void 0 ? void 0 : _a[childrenName], i));\n      columns.push(column);\n    }\n\n    return columns;\n  };\n\n  return withNativeProps(props, /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix\n  }, renderColumns()));\n};"]},"metadata":{},"sourceType":"module"}