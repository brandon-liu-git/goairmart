{"ast":null,"code":"import _regeneratorRuntime from \"/Users/brandonliu/Project/goairmart/antd-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { mergeProps } from '../../utils/with-default-props';\nimport { animated, useSpring } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { getScrollParent } from '../../utils/get-scroll-parent';\nimport React, { useRef, useState } from 'react';\nimport { supportsPassive } from '../../utils/supports-passive';\nimport { convertPx } from '../../utils/convert-px';\nimport { rubberbandIfOutOfBounds } from '../../utils/rubberband';\nimport { sleep } from '../../utils/sleep';\nvar classPrefix = \"adm-pull-to-refresh\";\nexport var defaultProps = {\n  pullingText: '下拉刷新',\n  canReleaseText: '释放立即刷新',\n  refreshingText: '加载中……',\n  completeText: '刷新成功',\n  completeDelay: 500,\n  onRefresh: function onRefresh() {}\n};\nexport var PullToRefresh = function PullToRefresh(p) {\n  var _a, _b;\n\n  var props = mergeProps(defaultProps, p);\n  var headHeight = (_a = props.headHeight) !== null && _a !== void 0 ? _a : convertPx(40);\n  var threshold = (_b = props.threshold) !== null && _b !== void 0 ? _b : convertPx(60);\n\n  var _useState = useState('pulling'),\n      status = _useState[0],\n      setStatus = _useState[1];\n\n  var _useSpring = useSpring(function () {\n    return {\n      from: {\n        height: 0\n      },\n      config: {\n        tension: 300,\n        friction: 30,\n        clamp: true\n      }\n    };\n  }),\n      springStyles = _useSpring[0],\n      api = _useSpring[1];\n\n  var elementRef = useRef(null);\n  var pullingRef = useRef(false);\n\n  function doRefresh() {\n    return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _this = this;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              api.start({\n                height: headHeight\n              });\n              setStatus('refreshing');\n              _context2.prev = 2;\n              _context2.next = 5;\n              return props.onRefresh();\n\n            case 5:\n              setStatus('complete');\n              _context2.next = 12;\n              break;\n\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](2);\n              setStatus('pulling');\n              throw _context2.t0;\n\n            case 12:\n              if (!(props.completeDelay > 0)) {\n                _context2.next = 15;\n                break;\n              }\n\n              _context2.next = 15;\n              return sleep(props.completeDelay);\n\n            case 15:\n              api.start({\n                to: function to(next) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _context.next = 2;\n                            return next({\n                              height: 0\n                            });\n\n                          case 2:\n                            _context.next = 4;\n                            return next({\n                              height: 0\n                            });\n\n                          case 4:\n                            setStatus('pulling');\n\n                          case 5:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n                }\n              });\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 8]]);\n    }));\n  }\n\n  useDrag(function (state) {\n    if (status === 'refreshing' || status === 'complete') return;\n    var event = state.event;\n\n    if (state.last) {\n      pullingRef.current = false;\n\n      if (status === 'canRelease') {\n        doRefresh();\n      } else {\n        api.start({\n          height: 0\n        });\n      }\n\n      return;\n    }\n\n    var _state$movement = state.movement,\n        y = _state$movement[1];\n\n    if (state.first) {\n      var element = elementRef.current;\n      if (!element) return;\n      var scrollParent = getScrollParent(element);\n      if (!scrollParent) return;\n      var top = 'scrollTop' in scrollParent ? scrollParent.scrollTop : scrollParent.pageYOffset;\n\n      if (top <= 0 && y > 0) {\n        pullingRef.current = true;\n      }\n    }\n\n    if (!pullingRef.current) return;\n\n    if (typeof event.cancelable !== 'boolean' || event.cancelable) {\n      event.preventDefault();\n    }\n\n    event.stopPropagation();\n    var height = Math.max(rubberbandIfOutOfBounds(y, 0, 0, headHeight * 5, 0.5), 0);\n    api.start({\n      height: height\n    });\n    setStatus(height > threshold ? 'canRelease' : 'pulling');\n  }, {\n    pointer: {\n      touch: true\n    },\n    axis: 'y',\n    target: elementRef,\n    eventOptions: supportsPassive ? {\n      passive: false\n    } : false\n  });\n\n  var renderStatusText = function renderStatusText() {\n    var _a;\n\n    if (props.renderText) {\n      return (_a = props.renderText) === null || _a === void 0 ? void 0 : _a.call(props, status);\n    }\n\n    if (status === 'pulling') return props.pullingText;\n    if (status === 'canRelease') return props.canReleaseText;\n    if (status === 'refreshing') return props.refreshingText;\n    if (status === 'complete') return props.completeText;\n  };\n\n  return /*#__PURE__*/React.createElement(animated.div, {\n    ref: elementRef,\n    className: classPrefix\n  }, /*#__PURE__*/React.createElement(animated.div, {\n    style: springStyles,\n    className: classPrefix + \"-head\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix + \"-head-content\",\n    style: {\n      height: headHeight\n    }\n  }, renderStatusText())), /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix + \"-content\"\n  }, props.children));\n};","map":{"version":3,"sources":["/Users/brandonliu/Project/goairmart/antd-demo/node_modules/antd-mobile/es/components/pull-to-refresh/pull-to-refresh.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","mergeProps","animated","useSpring","useDrag","getScrollParent","React","useRef","useState","supportsPassive","convertPx","rubberbandIfOutOfBounds","sleep","classPrefix","defaultProps","pullingText","canReleaseText","refreshingText","completeText","completeDelay","onRefresh","PullToRefresh","p","_a","_b","props","headHeight","threshold","_useState","status","setStatus","_useSpring","from","height","config","tension","friction","clamp","springStyles","api","elementRef","pullingRef","doRefresh","mark","_callee2","_this","wrap","_callee2$","_context2","prev","start","t0","to","_callee","_callee$","_context","stop","state","event","last","current","_state$movement","movement","y","first","element","scrollParent","top","scrollTop","pageYOffset","cancelable","preventDefault","stopPropagation","Math","max","pointer","touch","axis","target","eventOptions","passive","renderStatusText","renderText","call","createElement","div","ref","className","style","children"],"mappings":"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","sourcesContent":["var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { mergeProps } from '../../utils/with-default-props';\nimport { animated, useSpring } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { getScrollParent } from '../../utils/get-scroll-parent';\nimport React, { useRef, useState } from 'react';\nimport { supportsPassive } from '../../utils/supports-passive';\nimport { convertPx } from '../../utils/convert-px';\nimport { rubberbandIfOutOfBounds } from '../../utils/rubberband';\nimport { sleep } from '../../utils/sleep';\nvar classPrefix = \"adm-pull-to-refresh\";\nexport var defaultProps = {\n  pullingText: '下拉刷新',\n  canReleaseText: '释放立即刷新',\n  refreshingText: '加载中……',\n  completeText: '刷新成功',\n  completeDelay: 500,\n  onRefresh: function onRefresh() {}\n};\nexport var PullToRefresh = function PullToRefresh(p) {\n  var _a, _b;\n\n  var props = mergeProps(defaultProps, p);\n  var headHeight = (_a = props.headHeight) !== null && _a !== void 0 ? _a : convertPx(40);\n  var threshold = (_b = props.threshold) !== null && _b !== void 0 ? _b : convertPx(60);\n\n  var _useState = useState('pulling'),\n      status = _useState[0],\n      setStatus = _useState[1];\n\n  var _useSpring = useSpring(function () {\n    return {\n      from: {\n        height: 0\n      },\n      config: {\n        tension: 300,\n        friction: 30,\n        clamp: true\n      }\n    };\n  }),\n      springStyles = _useSpring[0],\n      api = _useSpring[1];\n\n  var elementRef = useRef(null);\n  var pullingRef = useRef(false);\n\n  function doRefresh() {\n    return __awaiter(this, void 0, void 0, /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n      var _this = this;\n\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              api.start({\n                height: headHeight\n              });\n              setStatus('refreshing');\n              _context2.prev = 2;\n              _context2.next = 5;\n              return props.onRefresh();\n\n            case 5:\n              setStatus('complete');\n              _context2.next = 12;\n              break;\n\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](2);\n              setStatus('pulling');\n              throw _context2.t0;\n\n            case 12:\n              if (!(props.completeDelay > 0)) {\n                _context2.next = 15;\n                break;\n              }\n\n              _context2.next = 15;\n              return sleep(props.completeDelay);\n\n            case 15:\n              api.start({\n                to: function to(next) {\n                  return __awaiter(_this, void 0, void 0, /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n                    return regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _context.next = 2;\n                            return next({\n                              height: 0\n                            });\n\n                          case 2:\n                            _context.next = 4;\n                            return next({\n                              height: 0\n                            });\n\n                          case 4:\n                            setStatus('pulling');\n\n                          case 5:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n                }\n              });\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 8]]);\n    }));\n  }\n\n  useDrag(function (state) {\n    if (status === 'refreshing' || status === 'complete') return;\n    var event = state.event;\n\n    if (state.last) {\n      pullingRef.current = false;\n\n      if (status === 'canRelease') {\n        doRefresh();\n      } else {\n        api.start({\n          height: 0\n        });\n      }\n\n      return;\n    }\n\n    var _state$movement = state.movement,\n        y = _state$movement[1];\n\n    if (state.first) {\n      var element = elementRef.current;\n      if (!element) return;\n      var scrollParent = getScrollParent(element);\n      if (!scrollParent) return;\n      var top = 'scrollTop' in scrollParent ? scrollParent.scrollTop : scrollParent.pageYOffset;\n\n      if (top <= 0 && y > 0) {\n        pullingRef.current = true;\n      }\n    }\n\n    if (!pullingRef.current) return;\n\n    if (typeof event.cancelable !== 'boolean' || event.cancelable) {\n      event.preventDefault();\n    }\n\n    event.stopPropagation();\n    var height = Math.max(rubberbandIfOutOfBounds(y, 0, 0, headHeight * 5, 0.5), 0);\n    api.start({\n      height: height\n    });\n    setStatus(height > threshold ? 'canRelease' : 'pulling');\n  }, {\n    pointer: {\n      touch: true\n    },\n    axis: 'y',\n    target: elementRef,\n    eventOptions: supportsPassive ? {\n      passive: false\n    } : false\n  });\n\n  var renderStatusText = function renderStatusText() {\n    var _a;\n\n    if (props.renderText) {\n      return (_a = props.renderText) === null || _a === void 0 ? void 0 : _a.call(props, status);\n    }\n\n    if (status === 'pulling') return props.pullingText;\n    if (status === 'canRelease') return props.canReleaseText;\n    if (status === 'refreshing') return props.refreshingText;\n    if (status === 'complete') return props.completeText;\n  };\n\n  return /*#__PURE__*/React.createElement(animated.div, {\n    ref: elementRef,\n    className: classPrefix\n  }, /*#__PURE__*/React.createElement(animated.div, {\n    style: springStyles,\n    className: classPrefix + \"-head\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix + \"-head-content\",\n    style: {\n      height: headHeight\n    }\n  }, renderStatusText())), /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix + \"-content\"\n  }, props.children));\n};"]},"metadata":{},"sourceType":"module"}