{"ast":null,"code":"import { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState } from 'react';\nimport Popup from '../popup';\nimport Item, { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nvar classPrefix = \"adm-dropdown\";\nvar defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true\n};\n\nvar Dropdown = function Dropdown(p) {\n  var _classNames;\n\n  var props = mergeProps(defaultProps, p);\n\n  var _usePropsValue = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  }),\n      value = _usePropsValue[0],\n      setValue = _usePropsValue[1];\n\n  var navRef = useRef(null);\n  var contentRef = useRef(null); // 点击外部区域，关闭\n\n  useClickAway(function () {\n    setValue(null);\n  }, [navRef, contentRef]); // 计算 navs 的 top 值\n\n  var _useState = useState(),\n      top = _useState[0],\n      setTop = _useState[1];\n\n  var containerRef = useRef(null);\n  useEffect(function () {\n    var container = containerRef.current;\n    if (!container) return;\n\n    if (value) {\n      var rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n\n  var changeActive = function changeActive(key) {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n\n  var popupForceRender = false;\n  var items = [];\n  var navs = React.Children.map(props.children, function (child) {\n    if ( /*#__PURE__*/React.isValidElement(child)) {\n      var childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: function onClick() {\n          changeActive(child.key);\n        },\n        active: child.key === value\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return /*#__PURE__*/cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  return withNativeProps(props, /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(classPrefix, (_classNames = {}, _classNames[classPrefix + \"-open\"] = !!value, _classNames)),\n    ref: containerRef\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix + \"-nav\",\n    ref: navRef\n  }, navs), /*#__PURE__*/React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: classPrefix + \"-popup\",\n    maskClassName: classPrefix + \"-popup-mask\",\n    bodyClassName: classPrefix + \"-popup-body\",\n    style: {\n      top: top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? function () {\n      changeActive(null);\n    } : undefined\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(function (item) {\n    var isActive = item.key === value;\n    return /*#__PURE__*/React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose,\n      onClick: item.props.closeOnContentClick ? function () {\n        changeActive(null);\n      } : undefined\n    }, item.props.children);\n  })))));\n};\n\nDropdown.Item = Item;\nexport default Dropdown;","map":{"version":3,"sources":["/Users/brandonliu/Project/goairmart/antd-demo/node_modules/antd-mobile/es/components/dropdown/dropdown.js"],"names":["useClickAway","classNames","React","cloneElement","useEffect","useRef","useState","Popup","Item","ItemChildrenWrap","withNativeProps","mergeProps","usePropsValue","classPrefix","defaultProps","defaultActiveKey","closeOnMaskClick","Dropdown","p","_classNames","props","_usePropsValue","value","activeKey","defaultValue","onChange","setValue","navRef","contentRef","_useState","top","setTop","containerRef","container","current","rect","getBoundingClientRect","bottom","changeActive","key","popupForceRender","items","navs","Children","map","children","child","isValidElement","childProps","Object","assign","onClick","active","push","forceRender","createElement","className","ref","visible","position","maskClassName","bodyClassName","style","onMaskClick","undefined","item","isActive","destroyOnClose","closeOnContentClick"],"mappings":"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","sourcesContent":["import { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState } from 'react';\nimport Popup from '../popup';\nimport Item, { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nvar classPrefix = \"adm-dropdown\";\nvar defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true\n};\n\nvar Dropdown = function Dropdown(p) {\n  var _classNames;\n\n  var props = mergeProps(defaultProps, p);\n\n  var _usePropsValue = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  }),\n      value = _usePropsValue[0],\n      setValue = _usePropsValue[1];\n\n  var navRef = useRef(null);\n  var contentRef = useRef(null); // 点击外部区域，关闭\n\n  useClickAway(function () {\n    setValue(null);\n  }, [navRef, contentRef]); // 计算 navs 的 top 值\n\n  var _useState = useState(),\n      top = _useState[0],\n      setTop = _useState[1];\n\n  var containerRef = useRef(null);\n  useEffect(function () {\n    var container = containerRef.current;\n    if (!container) return;\n\n    if (value) {\n      var rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n\n  var changeActive = function changeActive(key) {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n\n  var popupForceRender = false;\n  var items = [];\n  var navs = React.Children.map(props.children, function (child) {\n    if ( /*#__PURE__*/React.isValidElement(child)) {\n      var childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: function onClick() {\n          changeActive(child.key);\n        },\n        active: child.key === value\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return /*#__PURE__*/cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  return withNativeProps(props, /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(classPrefix, (_classNames = {}, _classNames[classPrefix + \"-open\"] = !!value, _classNames)),\n    ref: containerRef\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classPrefix + \"-nav\",\n    ref: navRef\n  }, navs), /*#__PURE__*/React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: classPrefix + \"-popup\",\n    maskClassName: classPrefix + \"-popup-mask\",\n    bodyClassName: classPrefix + \"-popup-body\",\n    style: {\n      top: top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? function () {\n      changeActive(null);\n    } : undefined\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(function (item) {\n    var isActive = item.key === value;\n    return /*#__PURE__*/React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose,\n      onClick: item.props.closeOnContentClick ? function () {\n        changeActive(null);\n      } : undefined\n    }, item.props.children);\n  })))));\n};\n\nDropdown.Item = Item;\nexport default Dropdown;"]},"metadata":{},"sourceType":"module"}